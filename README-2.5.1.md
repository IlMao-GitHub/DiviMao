# Divi Smart Node
This procedure should helps to update our Divi Core, in this case from 2.0.1 to 2.5.1. If you need to install it from scratch you can use the procedure I wrote for 1.0.8 located [here](https://github.com/IlMao-GitHub/DiviMao/blob/master/README-1.0.8.md). This procedure should work with any Raspberry, though due to memory contrains a Pi 4B with 4 GB is highly recommended. 

# System requirements
I'm using a Raspberry Pi 4B with a 32GB Class 10 microSD card and 4GB of RAM.
Respect to previous guides, I've now changed my aliases, removing the release from directory names, and creating a symbolic link to the right one. In this way, you don't have to change release number at every upgrade.
To create the link, I suggest you to `cd` yourself in home directory (/home/pi in this example) and use the command `ln -sfn divi-2.5.1/bin dividir` to create/change it.  
**Note: While no issues have been found with this implementation, this software is considered to be in an Alpha stage. Use at your own risk and *always* back up your mnemonic seed phrase before transacting with any real funds**

# Download and configure Divi core 2.5.1

1. Download Divi core 2.5.1: `cd; wget https://github.com/DiviProject/Divi/releases/download/v2.5.1/divi-2.5.1-RPi2.tar.gz`
2. Unpack tarball: `tar xvf divi-2.5.1-RPi2.tar.gz`. Your executables will go in /home/pi/divi-2.5.1/bin. 
3. Stop your divid process: `dli stop`
4. Wait for shutdown. You can check the process using `dividebug` alias; wait for `Shutdown: done` message. CTRL-C to exit.
5. Update your dividir link to reflect new release, using the following command: `ln -sfn divi-2.5.1/bin dividir`
6. Check/update your aliases. Note the reference to the dividir link previously created. You can update your ~/.bash_aliases, and load them with `source ~/.bash_aliases`  
```
# System
alias aliasfile="sudo nano ~/.bash_aliases"
alias aliasreload="source ~/.bash_aliases"
alias sweep="cat /dev/null > ~/.bash_history && history -c && exit"

# Divi
alias init-divi-conf="mv ~/divisetup-complete.sh ~/divisetup-run.sh"
alias dli="~/dividir/bin/divi-cli"
alias dividebug="sudo tail -f ~/.divi/debug.log"
alias divistart="~/dividir/bin/divid"
alias dividir="cd ~/dividir/bin"
alias datadir="cd ~/.divi"
alias divistat='dli getinfo; dli mnsync status; dli getblockchaininfo; dli getstakingstatus'
alias diviuserdelete="sudo rm -rf ~/.divi/backups ~/.divi/divi.conf ~/.divi/masternode.conf ~/.divi/mnpayments.dat ~/.divi/wallet.da
t"
alias diviclearcache="sudo rm -rf ~/.divi/blocks ~/.divi/chainstate ~/.divi/database ~/.divi/zerocoin ~/.divi/.lock ~/.divi/db.log ~
/.divi/debug.log ~/.divi/fee_estimates.dat ~/.divi/mncache.dat ~/.divi/netfulfilled.dat ~/.divi/peers.dat ~/.divi/sporks"
alias divirefresh="~/dividir/bin/divid -reindex"
alias divirescan="~/dividir/bin/divid -rescan"
alias ll='ls -la'
```
For an alias description, please refer to official [github page](https://github.com/DiviProject/divi-smart-node).

7. Remove files mncache.dat and mnpayments.dat (as suggested by Release Notes); the updates to the masternodes and block indices can trigger an error if disk files are not regenerated by the daemon 
8. Restart divid again with -reindex option (as suggested by Release Notes): issue `divirefresh` if you have set up aliases as described before. It should show "DIVI server starting", and reindex should start. You can monitor advance of sync through commands `dli getinfo` (blocks must reach the highest block in blockchain, reindexing everything and syncing blocks generated during the shutdown), or `dli mnsync status`, where IsBlockchainSynced must be true, RequestMasternodeAssets must be 999 and RequestMasternodeAttempt must be 0. This could takes some hours, depending of your networks. At the end, stop divid (`dli stop`) and start it normally (`divistart`), in order to activate Staking.
9. Don't forget to update your /etc/rc.local, if you want to run divid at boot:
```
su pi -c '/home/pi/dividir/bin/divid -daemon -pid=/home/pi/.divi/divid.pid -conf=/home/pi/.divi/divi.conf -datadir=/home/pi/.divi'
```

For further information, please refer to the official pages on [Divi Project Wiki](https://wiki.diviproject.org/) and on [GitHub] (https://github.com/DiviProject/Divi/releases/tag/v2.5.1).
